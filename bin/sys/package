#!/bin/bash


function update_mirr() {
	dateprefix=$(date +"%H%S")
	sudo cp /etc/pacman.d/mirrorlist /etc/pacman.d/mirrorlist-$dateprefix &&
	touch /etc/pacman.d/mirrorlist
	sudo reflector --country 'Indonesia,Singapore,Malaysia' --ipv4 --save /etc/pacman.d/mirrorlist
}

function update_main() {
	yes Y | sudo pacman -Sy &&
	yes Y | sudo pacman -Syu &&
	sudo rm -fr ~/.cache/*
}

function update_aurs() {
	yes y | yay -Scc &&
	rm -fr ~/.cache/*
}


function update_gits_rbin() {
	if [[ -d  /usr/local/rbin ]];then
		sudo rm -fr /usr/local/rbin
	fi
	sudo git clone git@github.com:blackbird-package/main-scripts.git /usr/local/rbin


	sudo echo 'source /usr/local/rbin/init' > '/etc/profile'
	sudo echo 'profil_main' > '/etc/profile'

	sudo echo 'source /usr/local/rbin/init' > '/etc/bashrc'
	sudo echo 'bashrc_main' > '/etc/profile'
}


function update_gits() {
	update_gits_rbin
}

function update() {

	bb_rbin_head "PACKAGE UPDATE"
	read -p "Hello $USER, Do you want update your system right now ? ( Y/n ) " BLACKBIRD_UPDATE

	if [[ $BLACKBIRD_UPDATE == "Y" || $BLACKBIRD_UPDATE == "y" ]];then
		update_mirr
		update_main 
		update_gits
		update_aurs
	fi
}


function cleaner() {
    
	bb_rbin_head "PACKAGE CLEANER"

    yes y | sudo pacman -Scc > /dev/null 2>&1 &&
    echo '  --> pacman package clean'
    if [[ ! -z $(pacman -Qtdq) ]];then
        yes y | sudo pacman -R $(pacman -Qtdq) > /dev/null 2>&1
        echo '  --> unused package clean'
    fi

    yes y | yay -Scc > /dev/null 2>&1 &&
    echo '  --> pacman cache clean'
    yes y | rm -fr $HOME/.cache/* > /dev/null 2>&1
    echo '  --> user cache clean'
}