#!/bin/bash


function update_mirr() {
	rm -f mirrorlist-backup &&
	if [[ -f /etc/pacman.d/mirrorlist ]];then
		sudo cp /etc/pacman.d/mirrorlist /etc/pacman.d/mirrorlist-backup 
	else
		touch /etc/pacman.d/mirrorlist
	fi
	sudo reflector --country 'Indonesia,Singapore,Malaysia' --ipv4 --save /etc/pacman.d/mirrorlist
}

function update_main() {
	yes Y | sudo pacman -Syuq &&
	echo 'Update main package'
	sudo rm -fr ~/.cache/*
}

function update_aurs() {
	yes y | yay -Syuq &&
	echo 'Update community package'
	rm -fr ~/.cache/*
}


function update_gits_rbin() {
	if [[ -d  /usr/local/rbin ]];then
		sudo rm -fr /usr/local/rbin
	fi
	sudo git clone -q https://github.com/blackbird-package/main-scripts.git /usr/local/rbin > /dev/null &&
	echo 'Update rbin package'

	sudo mv -f /usr/local/rbin/profile /etc/profile
	sudo mv -f /usr/local/rbin/bashrc /etc/bash.bashrc
}

function update_gits_hypr() {

	if [[  $XDG_CURRENT_DESKTOP -eq "Hyprland" ]] ;then	
		echo 'Hyprland'
	fi
}


function update_gits() {
	update_gits_rbin
	update_gits_hypr
	echo 'git package updated'
}


function update() {

	bb_rbin_head "PACKAGE UPDATE"
	read -p "Hello $USER, Do you want update your system right now ? ( Y/n ) " BLACKBIRD_UPDATE

	if [[ $BLACKBIRD_UPDATE == "Y" || $BLACKBIRD_UPDATE == "y" ]];then
		update_mirr &&
		update_main &&
		update_gits &&
		update_aurs &&
		source /etc/profile &&
		source /etc/bash.bashrc
	fi
}


function cleaner() {
    
	bb_rbin_head "PACKAGE CLEANER"

    yes Y | sudo pacman -Scc > /dev/null 2>&1 &&
    echo '  --> pacman package clean'
    if [[ ! -z $(pacman -Qtdq) ]];then
        yes Y | sudo pacman -R $(pacman -Qtdq) > /dev/null 2>&1
        echo '  --> unused package clean'
    fi

    yes Y | yay -Scc > /dev/null 2>&1 &&
    echo '  --> pacman cache clean'
    yes Y | rm -fr $HOME/.cache/* > /dev/null 2>&1
    echo '  --> user cache clean'
}
